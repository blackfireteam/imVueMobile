(function(e){function n(n){for(var o,r,i=n[0],c=n[1],u=n[2],l=0,d=[];l<i.length;l++)r=i[l],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);f&&f(n);while(d.length)d.shift()();return s.push.apply(s,u||[]),t()}function t(){for(var e,n=0;n<s.length;n++){for(var t=s[n],o=!0,r=1;r<t.length;r++){var i=t[r];0!==a[i]&&(o=!1)}o&&(s.splice(n--,1),e=c(c.s=t[0]))}return e}var o={},r={app:0},a={app:0},s=[];function i(e){return c.p+"js/"+({chats:"chats",home:"home",login:"login",messages:"messages",my:"my",register:"register",search:"search"}[e]||e)+"."+{chats:"108ef07b",home:"0985aab3",login:"fb60d513",messages:"92e1d824",my:"d5d9ed83",register:"301da287",search:"cb0efec8"}[e]+".js"}function c(n){if(o[n])return o[n].exports;var t=o[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.e=function(e){var n=[],t={chats:1,home:1,login:1,messages:1,my:1,register:1};r[e]?n.push(r[e]):0!==r[e]&&t[e]&&n.push(r[e]=new Promise((function(n,t){for(var o="css/"+({chats:"chats",home:"home",login:"login",messages:"messages",my:"my",register:"register",search:"search"}[e]||e)+"."+{chats:"e5dfb01c",home:"be646f04",login:"4c328789",messages:"dc3dd5cb",my:"599e8cff",register:"d12bb5e0",search:"31d6cfe0"}[e]+".css",a=c.p+o,s=document.getElementsByTagName("link"),i=0;i<s.length;i++){var u=s[i],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===a))return n()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){u=d[i],l=u.getAttribute("data-href");if(l===o||l===a)return n()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=n,f.onerror=function(n){var o=n&&n.target&&n.target.src||a,s=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=o,delete r[e],f.parentNode.removeChild(f),t(s)},f.href=a;var m=document.getElementsByTagName("head")[0];m.appendChild(f)})).then((function(){r[e]=0})));var o=a[e];if(0!==o)if(o)n.push(o[2]);else{var s=new Promise((function(n,t){o=a[e]=[n,t]}));n.push(o[2]=s);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=i(e);var d=new Error;u=function(n){l.onerror=l.onload=null,clearTimeout(f);var t=a[e];if(0!==t){if(t){var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;d.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",d.name="ChunkLoadError",d.type=o,d.request=r,t[1](d)}a[e]=void 0}};var f=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(n)},c.m=e,c.c=o,c.d=function(e,n,t){c.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,n){if(1&n&&(e=c(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(c.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)c.d(t,o,function(n){return e[n]}.bind(null,o));return t},c.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(n,"a",n),n},c.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},c.p="",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=n,u=u.slice();for(var d=0;d<u.length;d++)n(u[d]);var f=l;s.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"1f6d":function(e,n,t){},"56d7":function(e,n,t){"use strict";t.r(n);t("e7e5");var o=t("d399"),r=(t("66cf"),t("343b")),a=(t("b000"),t("1a23")),s=(t("38d5"),t("772a")),i=(t("a52c"),t("2ed4")),c=(t("537a"),t("ac28")),u=(t("4467"),t("c36e")),l=(t("0653"),t("34e9")),d=(t("c194"),t("7744")),f=(t("ab71"),t("58e6")),m=(t("2994"),t("2bdd")),h=(t("e930"),t("8f80")),g=(t("0ec5"),t("21ab")),p=(t("3df5"),t("2830")),b=(t("5246"),t("6b41")),v=(t("66b9"),t("b650")),I=(t("be7f"),t("565f")),y=(t("4056"),t("44bf")),O=(t("c3a6"),t("ad06")),w=(t("e260"),t("e6cf"),t("cca6"),t("a79d"),t("159b"),t("b0c0"),t("7a23"));function E(e,n,t,o,r,a){var s=Object(w["D"])("router-view");return o.data.isInit?(Object(w["w"])(),Object(w["f"])(s,{key:0})):Object(w["g"])("",!0)}t("d3b7");var j=t("5502"),C=t("6c02"),L={name:"App",setup:function(){var e=Object(w["k"])().appContext.config.globalProperties,n=e.$IM,t=e.$msim,o=e.$toast,r=Object(j["b"])(),a=Object(C["d"])(),s=Object(C["c"])(),i=Object(w["A"])({isInit:!1});function c(){t.on(n.EVENT.CONNECT_CHANGE,l),t.on(n.EVENT.LOGIN,d),t.on(n.EVENT.LOGOUT,f),t.on(n.EVENT.KICKED_OUT,m),t.on(n.EVENT.TOKEN_NOT_FOUND,h),t.on(n.EVENT.SYNC_CHATS_CHANGE,g),t.on(n.EVENT.CONVERSATION_LIST_UPDATED,p);var e=window.localStorage.getItem("userId")||null;if(e){i.isInit=!1;var c=window.localStorage.getItem("wsUrL"),u=window.localStorage.getItem("imToken"),b=o.loading({message:"登陆中...",forbidClick:!0,duration:0,loadingType:"spinner"});t.login({wsUrl:c,imToken:u,subAppId:1}).then((function(n){b.close(),r.commit("setUserId",e)})).catch((function(e){null!==e&&void 0!==e&&e.msg&&o(e.msg)})).finally((function(){i.isInit=!0}))}else"login"!==s.name&&a.push({name:"login"}),i.isInit=!0}function u(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("wsUrL"),window.localStorage.removeItem("imToken"),r.commit("clear"),a.push({name:"login"})}function l(e){console.log("连接状态变更",e)}function d(e){console.log("登录成功",e);var n=window.localStorage.getItem("userId");n&&(r.commit("setUserId",n),"login"===s.name&&a.push({name:"home"}))}function f(e){console.log("退出成功",e),u()}function m(e){console.log("被踢",e),u()}function h(e){console.log("token失效",e),u()}function g(e){console.log("同步会话",e)}function p(e){console.log("会话列表更新",e.data),r.commit("updateChats",e.data),t.getAllUnreadCount().then((function(e){console.log(1414,e),r.commit("setUnread",e.data.unread)}))}return Object(w["t"])((function(){c()})),{data:i}}};t("d6fa");L.render=E;var D=L,T=(t("3ca3"),t("ddb0"),Object(C["b"])()),N=Object(C["a"])({history:T,routes:[{path:"/",name:"login",component:function(){return t.e("login").then(t.bind(null,"dd1d"))}},{path:"/register",name:"register",component:function(){return t.e("register").then(t.bind(null,"cbf3"))}},{path:"/home",name:"home",component:function(){return t.e("home").then(t.bind(null,"7f63"))},redirect:"/chats",children:[{path:"/chats",name:"chats",component:function(){return t.e("chats").then(t.bind(null,"3114"))}},{path:"/search",name:"search",component:function(){return t.e("search").then(t.bind(null,"159f"))}},{path:"/my",name:"my",component:function(){return t.e("my").then(t.bind(null,"31cc"))}}]},{path:"/messages/:conversationID/:uid",name:"messages",component:function(){return t.e("messages").then(t.bind(null,"a7f0"))}}]});N.beforeEach((function(e,n,t){var o=window.localStorage.getItem("userId")||null;o||"login"===e.name||"register"===e.name?e.name?t():t("/home"):t({name:"login"})}));var S=N,U=t("2909"),P=(t("4de4"),t("7db0"),t("4e82"),Object(j["a"])({state:function(){return{curUserId:null,chatList:[],msgList:[],curConversationID:null,allUnread:0}},mutations:{clear:function(e){e.curUserId=null,e.chatList=[],e.msgList=[],e.curConversationID=null,e.allUnread=0},setUnread:function(e,n){e.allUnread=n},setUserId:function(e,n){e.curUserId=n},clearChats:function(e){e.chatList=[]},addChats:function(e,n){var t;(t=e.chatList).push.apply(t,Object(U["a"])(n))},addChat:function(e,n){e.chatList.unshift(n)},changeChat:function(e,n){e.curConversationID=n,e.msgList=[]},updateChats:function(e,n){n.forEach((function(n){if(n.deleted)e.chatList=e.chatList.filter((function(t){return n.conversationID===e.curConversationID&&(e.curConversationID=null),t.conversationID!==n.conversationID}));else{var t=e.chatList.find((function(e){return e.conversationID===n.conversationID}));t?Object.assign(t,n):e.chatList.unshift(n)}})),e.chatList.sort((function(e,n){return n.showMsgTime-e.showMsgTime})),!e.curConversationID&&e.chatList.length&&(e.curConversationID=e.chatList[0].conversationID,e.msgList=[])},addMsgs:function(e,n){var t;(t=e.msgList).unshift.apply(t,Object(U["a"])(n))},addMsg:function(e,n){e.msgList.push(n)},updateMsgs:function(e,n){e.curConversationID&&n.forEach((function(n){if(n.conversationID===e.curConversationID){var t=e.msgList.find((function(e){return e.onlyId===n.onlyId}));t?Object.assign(t,n):e.msgList.push(n)}}))},revokeMsgs:function(e,n){e.curConversationID&&n.forEach((function(n){if(n.conversationID===e.curConversationID){var t=e.msgList.find((function(e){return e.msgId===n.msgId}));t&&Object.assign(t,n)}}))},updateMsg:function(e,n){var t=e.msgList.find((function(e){return e.conversationID===n.conversationID&&e.onlyId===n.onlyId}));t&&Object.assign(t,n)}}})),_=P,k=t("bc3a"),A=t.n(k),M=t("6199"),x=t.n(M),V=5e3,$="https://im.ekfree.com:18788/",G=A.a.create({timeout:V,baseURL:$});G.interceptors.request.use((function(e){var n="asfasdasd123",t=Math.ceil(1e10*Math.random()),o=1e3*(new Date).getTime(),r=x()(n+t+o);return e.headers["nonce"]=t,e.headers["timestamp"]=o,e.headers["sig"]=r,e.headers["app_id"]=1,e}),(function(e){Promise.reject(e)})),G.interceptors.response.use((function(e){var n=e.data;if(n&&0===n.code)return e.data;var t="接口参数错误";return 2001===n.code?t="图形验证码错误":n&&n.msg&&(t=n.msg),Object(o["a"])(t),Promise.reject(n)}),(function(e){return Promise.reject(e)}));var H=G,K=t("1d37"),q=t.n(K),B=(t("499a"),t("157a"),[O["b"],y["b"],I["a"],v["a"],b["a"],p["a"],g["a"],h["a"],m["a"],f["a"],d["b"],l["a"],u["a"],c["a"],i["a"],s["a"],a["a"]]),F=[r["a"],o["a"]],J=Object(w["e"])(D);J.config.globalProperties.$IM=q.a,J.config.globalProperties.$http=H,B.forEach((function(e){J.component(e.name,e)})),F.forEach((function(e){J.use(e)})),J.use(_),J.use(S),q.a.create().then((function(e){J.config.globalProperties.$msim=e,J.mount("#app")}))},d6fa:function(e,n,t){"use strict";t("1f6d")}});